<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>خريطة الحرب الصينية اليابانية WWII</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  body { margin:0; font-family: system-ui, Arial; direction: rtl; }
  #map { position: absolute; top:0; bottom:100px; left:0; right:0; }
  #controls { position:absolute; bottom:0; left:10px; right:10px; height:100px;
              background: rgba(255,255,255,0.95); border-radius:8px; padding:8px; display:flex; flex-direction:column; justify-content:center; gap:8px;}
  #legend { position:absolute; top:10px; right:10px; background:rgba(255,255,255,0.9); padding:8px; border-radius:6px; }
  #dateLabel { font-weight:600; font-size:18px; }
</style>
</head>
<body>

<div id="map"></div>
<div id="controls">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <button id="playBtn">تشغيل ▶</button>
    <button id="pauseBtn" style="display:none;">إيقاف ⏸</button>
    <div id="dateLabel">1937</div>
  </div>
  <input type="range" min="1937" max="1945" step="1" value="1937" id="timeSlider" style="width:100%">
</div>

<div id="legend">
  <b>مفتاح الخريطة</b><br/>
  <span style="color:red;">■ الصين</span><br/>
  <span style="color:blue;">■ اليابان / مناطق السيطرة</span>
</div>

<!-- إذا تحب تضيف موسيقى حربية -->
<!--
<audio id="bgMusic" loop>
  <source src="war_music.mp3" type="audio/mpeg">
</audio>
-->

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// --- إعداد الخريطة ---
const map = L.map('map').setView([35, 115], 4);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

// --- حدود الصين واليابان (GeoJSON مبسط) ---
const chinaBounds = [[18, 73], [54, 135]];  // تقريب
const japanBounds = [[30, 128], [46, 146]]; // تقريب

// --- بيانات توسع اليابان حسب السنوات ---
const japanExpansion = {
  1937: [[30, 115], [33, 121]],
  1938: [[29, 112], [32, 115]],
  1939: [[36, 118], [39, 121]],
  1940: [[24, 110], [28, 114]],
  1941: [[21, 107], [24, 111]],
  1942: [[22, 100], [25, 106]],
  1943: [[35, 105], [38, 110]],
  1944: [[27, 100], [32, 107]],
  1945: null  // انسحاب
};

// --- رسم الخريطة حسب السنة ---
let chinaLayer, japanLayer, expansionLayer;
function drawMap(year){
  if(chinaLayer) map.removeLayer(chinaLayer);
  if(japanLayer) map.removeLayer(japanLayer);
  if(expansionLayer) map.removeLayer(expansionLayer);

  // الصين
  chinaLayer = L.rectangle(chinaBounds, {color:"red", weight:1, fillColor:"red", fillOpacity:0.3}).addTo(map);
  // اليابان
  japanLayer = L.rectangle(japanBounds, {color:"blue", weight:1, fillColor:"blue", fillOpacity:0.3}).addTo(map);

  // مناطق السيطرة
  const exp = japanExpansion[year];
  if(exp){
    expansionLayer = L.rectangle(exp, {color:"blue", weight:1, fillOpacity:0.5}).addTo(map);
  }

  document.getElementById('dateLabel').textContent = year;
}

// --- سلايدر ---
const slider = document.getElementById('timeSlider');
slider.addEventListener('input', e=> drawMap(e.target.value));

// --- تشغيل / إيقاف ---
let timer=null;
const playBtn = document.getElementById('playBtn');
const pauseBtn = document.getElementById('pauseBtn');
// const music = document.getElementById('bgMusic');

function play(){
  playBtn.style.display='none';
  pauseBtn.style.display='inline';
  // music.play();
  let year = parseInt(slider.value);
  timer = setInterval(()=>{
    if(year >= 1945){
      clearInterval(timer);
      playBtn.style.display='inline';
      pauseBtn.style.display='none';
      // music.pause();
      return;
    }
    year++;
    slider.value = year;
    drawMap(year);
  }, 2000);
}

function pause(){
  clearInterval(timer);
  playBtn.style.display='inline';
  pauseBtn.style.display='none';
  // music.pause();
}

playBtn.addEventListener('click', play);
pauseBtn.addEventListener('click', pause);

// --- عرض أول سنة ---
drawMap(1937);

</script>
</body>
</html>
