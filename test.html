<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø³Ø¹Ø±Ø§Øª ÙˆØ§Ù„Ù…Ø§ÙƒØ±ÙˆØ² â€” Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠ</title>
<style>
  :root{
    --bg1:#0f172a; --bg2:#111827; --card:#0b1222cc; --text:#eaf6ff; --muted:#9bb0c9;
    --acc1:#7ef0ff; --acc2:#b890ff; --acc3:#00e38b; --warn:#ffb84d; --danger:#ff6b6b;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui, -apple-system, "Segoe UI", Inter, Arial, "Noto Kufi Arabic";
    color:var(--text); background: radial-gradient(1200px 1200px at 10% -10%, #14213d 0%, transparent 60%) ,
                         radial-gradient(900px 900px at 110% 20%, #1f1647 0%, transparent 60%),
                         linear-gradient(120deg,var(--bg1),var(--bg2));
    min-height:100svh; overflow-x:hidden;
  }
  .nav{
    position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.2) blur(8px);
    background:linear-gradient(90deg,#081225cc,#0b1222cc);
    border-bottom:1px solid #223;
    padding:12px 16px; display:flex; align-items:center; justify-content:space-between;
  }
  .brand{font-weight:800; letter-spacing:.3px}
  .container{max-width:1100px; margin:24px auto; padding:0 16px}
  .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:14px}
  .card{
    grid-column:1/-1; background:linear-gradient(180deg,#0f1930cc,#0b1222cc);
    border:1px solid #22354d; border-radius:16px; padding:18px; box-shadow:0 10px 35px rgba(0,0,0,.35);
  }
  .two{grid-column:span 12}
  @media(min-width:860px){ .two{grid-column:span 6} }
  h1{margin:0 0 6px; font-size:28px}
  p.muted{color:var(--muted); margin:.25rem 0 1rem}
  label{font-size:13px; color:var(--muted); margin-bottom:6px; display:block}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  .row3{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
  .field{display:flex; flex-direction:column}
  input[type="number"], select, input[type="text"]{
    background:#0b1730; color:var(--text); border:1px solid #2c3e61; border-radius:12px; padding:10px 12px; outline:none;
  }
  input[type="number"]:focus, select:focus{border-color:#4a71ff}
  .seg{
    display:flex; background:#0b1730; border:1px solid #2c3e61; border-radius:12px; overflow:hidden;
  }
  .seg button{
    flex:1; padding:10px 8px; background:transparent; color:var(--muted); border:0; cursor:pointer; font-weight:700;
  }
  .seg button.active{color:#06101a; background:linear-gradient(90deg,var(--acc1),var(--acc2))}
  .btn{
    display:inline-block; border:0; border-radius:12px; padding:12px 16px; font-weight:800;
    background:linear-gradient(90deg,var(--acc1),var(--acc2)); color:#06101a; cursor:pointer;
    box-shadow:0 8px 24px rgba(126,240,255,.25);
  }
  .btn:disabled{opacity:.6; cursor:not-allowed}
  .btn-outline{background:transparent; border:1px solid #38507a; color:var(--text)}
  .spacer{height:8px}
  .results{
    display:grid; grid-template-columns:repeat(12,1fr); gap:12px;
  }
  .kpi{
    grid-column:span 12; background:#0b1730; border:1px solid #2c3e61; border-radius:12px; padding:14px;
  }
  @media(min-width:780px){ .kpi{grid-column:span 3} }
  .kpi h3{margin:0; font-size:13px; color:var(--muted)}
  .kpi .val{font-size:24px; font-weight:900; margin-top:6px}
  .bar{height:10px; background:#12203c; border-radius:999px; overflow:hidden; margin-top:8px}
  .bar > i{display:block; height:100%; width:0}
  .cal{background:linear-gradient(90deg,var(--acc3),#23a6d5)}
  .pro{background:linear-gradient(90deg,#49ffce,#66d1ff)}
  .fat{background:linear-gradient(90deg,#ffd166,#ff7c6b)}
  .carb{background:linear-gradient(90deg,#00d4ff,#9b7bff)}
  .tag{display:inline-block; font-size:12px; color:#06101a; background:linear-gradient(90deg,var(--acc1),var(--acc2));
    padding:4px 8px; border-radius:999px; font-weight:800}
  .tips{color:var(--muted); font-size:13px; line-height:1.6}
  .footer-note{color:var(--muted); font-size:12px; margin-top:10px}
  .glow{
    position:absolute; inset:auto -20% -40% -20%; height:300px; filter:blur(60px);
    background: radial-gradient(600px 140px at 80% 0%, #7ef0ff33, transparent 60%),
                radial-gradient(600px 140px at 10% 20%, #b890ff33, transparent 60%);
    pointer-events:none;
  }
</style>
</head>
<body>
  <header class="nav">
    <div class="brand">ğŸ‹ï¸â€â™‚ï¸ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</div>
    <div class="tag">Ø§Ø­ØªØ±Ø§ÙÙŠ</div>
  </header>

  <div class="container">
    <div class="grid">
      <section class="card two">
        <h1>Ø®Ø·Ù‘Ø· Ø³Ø¹Ø±Ø§ØªÙƒ Ùˆ Ù…Ø§ÙƒØ±ÙˆØ²Ùƒ</h1>
        <p class="muted">Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©: <b>Mifflinâ€“St Jeor</b> Ù„Ù€BMR + Ù…Ø¹Ø§Ù…Ù„ Ù†Ø´Ø§Ø· Ù„Ø­Ø³Ø§Ø¨ TDEE. Ø§Ø®ØªØ± Ù‡Ø¯ÙÙƒ ÙˆØ­Ø¯Ù‘Ø¯ Ø³Ø±Ø¹Ø© Ø§Ù„ØªØºÙŠÙŠØ±ØŒ ÙˆØ³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø³Ø¹Ø±Ø§Øª ÙŠÙˆÙ…ÙŠØ© ÙˆØªÙˆØ²ÙŠØ¹ Ù…Ø§ÙƒØ±ÙˆØ² Ù…Ù†Ø§Ø³Ø¨.</p>

        <form id="calcForm">
          <div class="row">
            <div class="field">
              <label>Ø§Ù„Ø¬Ù†Ø³</label>
              <div class="seg" id="genderSeg">
                <button type="button" data-val="male" class="active">Ø°ÙƒØ±</button>
                <button type="button" data-val="female">Ø£Ù†Ø«Ù‰</button>
              </div>
            </div>
            <div class="field">
              <label>Ø§Ù„ÙˆØ­Ø¯Ø§Øª</label>
              <div class="seg" id="unitSeg">
                <button type="button" data-val="metric" class="active">Ù…ØªØ±ÙŠ (ÙƒØº/Ø³Ù…)</button>
                <button type="button" data-val="imperial">Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (Ø±Ø·Ù„/Ø¥Ù†Ø´)</button>
              </div>
            </div>
          </div>

          <div class="row3">
            <div class="field">
              <label>Ø§Ù„Ø¹Ù…Ø± (Ø³Ù†Ø©)</label>
              <input type="number" id="age" min="10" max="100" required placeholder="Ù…Ø«Ø§Ù„: 28" value="28">
            </div>
            <div class="field">
              <label>Ø§Ù„Ø·ÙˆÙ„</label>
              <input type="number" id="height" min="80" max="250" step="0.1" required placeholder="Ø³Ù…">
            </div>
            <div class="field">
              <label>Ø§Ù„ÙˆØ²Ù†</label>
              <input type="number" id="weight" min="30" max="300" step="0.1" required placeholder="ÙƒØº">
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø´Ø§Ø·</label>
              <select id="activity" required>
                <option value="1.2">Ø®Ø§Ù…Ù„ (Ø¨Ø¯ÙˆÙ† ØªÙ…Ø§Ø±ÙŠÙ†)</option>
                <option value="1.375">Ø®ÙÙŠÙ (1â€“3 Ø£ÙŠØ§Ù…/Ø£Ø³Ø¨ÙˆØ¹)</option>
                <option value="1.55" selected>Ù…ØªÙˆØ³Ø· (3â€“5 Ø£ÙŠØ§Ù…/Ø£Ø³Ø¨ÙˆØ¹)</option>
                <option value="1.725">Ø¹Ø§Ù„Ù (6â€“7 Ø£ÙŠØ§Ù…/Ø£Ø³Ø¨ÙˆØ¹)</option>
                <option value="1.9">Ø´Ø¯ÙŠØ¯ Ø¬Ø¯Ù‹Ø§ (Ø¹Ù…Ù„ Ø¬Ø³Ø¯ÙŠ/ØªÙ…Ø§Ø±ÙŠÙ† Ù…Ø²Ø¯ÙˆØ¬Ø©)</option>
              </select>
            </div>
            <div class="field">
              <label>Ø§Ù„Ù‡Ø¯Ù</label>
              <select id="goal" required>
                <option value="lose">ØªÙ†Ø­ÙŠÙ</option>
                <option value="maintain" selected>Ø«Ø¨Ø§Øª</option>
                <option value="gain">Ø²ÙŠØ§Ø¯Ø© ÙˆØ²Ù†/ÙƒØªÙ„Ø©</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>Ø³Ø±Ø¹Ø© Ø§Ù„ØªØºÙŠÙŠØ± (ÙƒØº/Ø£Ø³Ø¨ÙˆØ¹)</label>
              <input type="range" id="rate" min="0.10" max="1.00" step="0.05" value="0.50">
              <div class="muted" id="rateLabel">0.50 ÙƒØº/Ø£Ø³Ø¨ÙˆØ¹</div>
            </div>
            <div class="field">
              <label>ØªØ±ÙƒÙŠØ¨Ø© Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† (Øº/ÙƒØº)</label>
              <input type="range" id="proteinPerKg" min="1.2" max="2.4" step="0.1" value="1.8">
              <div class="muted" id="proteinLabel">1.8 Øº/ÙƒØº</div>
            </div>
          </div>

          <div class="spacer"></div>
          <button class="btn" id="calcBtn" type="submit">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±Ø§Øª ÙˆØ§Ù„Ù…Ø§ÙƒØ±ÙˆØ²</button>
          <button class="btn btn-outline" id="resetBtn" type="button">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
        </form>
      </section>

      <section class="card two" id="resultsCard" style="display:none">
        <h2 style="margin-top:0">Ù†ØªØ§Ø¦Ø¬Ùƒ</h2>
        <div class="results">
          <div class="kpi">
            <h3>Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Cal)</h3>
            <div class="val" id="caloriesOut">â€”</div>
            <div class="bar"><i class="cal" id="calBar"></i></div>
          </div>
          <div class="kpi">
            <h3>Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† (Øº)</h3>
            <div class="val" id="proteinOut">â€”</div>
            <div class="bar"><i class="pro" id="proBar"></i></div>
          </div>
          <div class="kpi">
            <h3>Ø§Ù„Ø¯Ù‡ÙˆÙ† (Øº)</h3>
            <div class="val" id="fatOut">â€”</div>
            <div class="bar"><i class="fat" id="fatBar"></i></div>
          </div>
          <div class="kpi">
            <h3>Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª (Øº)</h3>
            <div class="val" id="carbOut">â€”</div>
            <div class="bar"><i class="carb" id="carbBar"></i></div>
          </div>
        </div>

        <div class="spacer"></div>
        <div class="row">
          <div>
            <div class="tag" id="goalBadge">Ø«Ø¨Ø§Øª</div>
            <p class="tips" id="deltaNote">â€”</p>
          </div>
          <div>
            <p class="tips" id="bmiNote">â€”</p>
          </div>
        </div>

        <div class="footer-note">ØªÙ†Ø¨ÙŠÙ‡ ØºÙŠØ± Ø·Ø¨ÙŠ: Ù‡Ø°Ù‡ ØªÙ‚Ø¯ÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© Ù„ÙØ£ØºØ±Ø§Ø¶ Ù„ÙŠØ§Ù‚ÙŠØ© ÙÙ‚Ø·ØŒ ÙˆÙ‚Ø¯ Ù„Ø§ ØªÙ†Ø§Ø³Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØµØ­ÙŠØ©. Ø§Ø³ØªØ´Ø± Ù…Ø®ØªØµÙ‹Ø§ Ø¥Ù† ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø­Ø§Ù„Ø© Ø·Ø¨ÙŠØ©.</div>
      </section>
    </div>
  </div>

  <div class="glow"></div>

<script>
(function(){
  const $ = (s)=>document.querySelector(s);
  const genderSeg = $("#genderSeg");
  const unitSeg = $("#unitSeg");
  const inputs = {
    age: $("#age"),
    height: $("#height"),
    weight: $("#weight"),
    activity: $("#activity"),
    goal: $("#goal"),
    rate: $("#rate"),
    proteinPerKg: $("#proteinPerKg"),
  };
  const labels = {
    rate: $("#rateLabel"),
    protein: $("#proteinLabel"),
    goalBadge: $("#goalBadge"),
    deltaNote: $("#deltaNote"),
    bmiNote: $("#bmiNote"),
    caloriesOut: $("#caloriesOut"),
    proteinOut: $("#proteinOut"),
    fatOut: $("#fatOut"),
    carbOut: $("#carbOut"),
    calBar: $("#calBar"),
    proBar: $("#proBar"),
    fatBar: $("#fatBar"),
    carbBar: $("#carbBar"),
  };
  const resultsCard = $("#resultsCard");
  const calcBtn = $("#calcBtn");
  const resetBtn = $("#resetBtn");

  // segmented toggles
  function segValue(seg){ return seg.querySelector("button.active").dataset.val; }
  function bindSeg(seg, onChange){
    seg.addEventListener("click",(e)=>{
      if(e.target.tagName!=="BUTTON") return;
      seg.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
      e.target.classList.add("active");
      onChange?.(e.target.dataset.val);
    });
  }
  bindSeg(genderSeg);
  bindSeg(unitSeg, (val)=> updateUnitPlaceholders(val));

  function updateUnitPlaceholders(unit){
    if(unit==="imperial"){
      inputs.height.placeholder="Ø¥Ù†Ø´";
      inputs.weight.placeholder="Ø±Ø·Ù„";
      inputs.height.min = 40; inputs.height.max = 100; // inches
      inputs.weight.min = 60; inputs.weight.max = 660; // lb
    }else{
      inputs.height.placeholder="Ø³Ù…";
      inputs.weight.placeholder="ÙƒØº";
      inputs.height.min = 80; inputs.height.max = 250;
      inputs.weight.min = 30; inputs.weight.max = 300;
    }
  }
  updateUnitPlaceholders(segValue(unitSeg));

  // live labels
  inputs.rate.addEventListener("input",()=>labels.rate.textContent = Number(inputs.rate.value).toFixed(2)+" ÙƒØº/Ø£Ø³Ø¨ÙˆØ¹");
  inputs.proteinPerKg.addEventListener("input",()=>labels.protein.textContent = Number(inputs.proteinPerKg.value).toFixed(1)+" Øº/ÙƒØº");

  // helpers
  const toNumber = (el)=> Number(String(el.value).replace(",", "."));
  const clamp = (v,min,max)=> Math.min(Math.max(v,min),max);

  function cmKgFromInputs(){
    const unit = segValue(unitSeg);
    let h = toNumber(inputs.height);
    let w = toNumber(inputs.weight);
    if(unit==="imperial"){
      // convert
      h = h * 2.54; // in -> cm
      w = w * 0.45359237; // lb -> kg
    }
    return { cm: h, kg: w };
  }

  function mifflinStJeor({gender, kg, cm, age}){
    // BMR (kcal/day)
    // male: 10W + 6.25H - 5A + 5
    // female: 10W + 6.25H - 5A - 161
    const base = 10*kg + 6.25*cm - 5*age + (gender==="male" ? 5 : -161);
    return base;
  }

  function compute(){
    // read
    const gender = segValue(genderSeg);
    const age = clamp(toNumber(inputs.age), 10, 100);
    const {cm, kg} = cmKgFromInputs();
    const activity = Number(inputs.activity.value);
    const goal = inputs.goal.value; // lose / maintain / gain
    const rate = clamp(Number(inputs.rate.value), 0.1, 1.0); // kg/week
    let proteinPerKg = clamp(Number(inputs.proteinPerKg.value), 1.2, 2.4);

    // validation
    if(!cm || !kg || !age || cm<80 || kg<30){ alert("ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø·ÙˆÙ„/Ø§Ù„ÙˆØ²Ù†/Ø§Ù„Ø¹Ù…Ø± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­."); return; }

    // baseline
    const bmr = mifflinStJeor({gender, kg, cm, age});
    const tdee = bmr * activity;

    // deficit/surplus
    const KCAL_PER_KG = 7700;
    let deltaPerDay = 0;
    if(goal==="lose") deltaPerDay = - (rate * KCAL_PER_KG) / 7;
    if(goal==="gain") deltaPerDay = + (rate * KCAL_PER_KG) / 7;

    let targetCalories = Math.round(tdee + deltaPerDay);

    // safety floors/ceilings (ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ø¹Ø§Ù…Ø©)
    const floor = gender==="male" ? 1500 : 1200;
    const ceil = 5000;
    targetCalories = clamp(targetCalories, floor, ceil);

    // protein grams
    if(goal==="lose") proteinPerKg = Math.max(proteinPerKg, 2.0); // Ø¯Ø¹Ù… Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØªÙ„Ø©
    const protein_g = Math.round(proteinPerKg * kg);

    // fat grams: 30% Ù…Ù† Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ØŒ ÙˆÙ…Ø¹ Ø­Ø¯ Ø£Ø¯Ù†Ù‰ 0.6 Øº/ÙƒØº
    const fat_g_by_pct = (targetCalories * 0.30) / 9;
    const fat_min = 0.6 * kg;
    const fat_g = Math.round(Math.max(fat_g_by_pct, fat_min));

    // carbs grams = Ø§Ù„Ø¨Ø§Ù‚ÙŠ
    const kcal_from_protein = protein_g * 4;
    const kcal_from_fat = fat_g * 9;
    let carb_kcal = targetCalories - (kcal_from_protein + kcal_from_fat);
    if(carb_kcal < 0){ // Ù„Ùˆ Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†/Ø§Ù„Ø¯Ù‡ÙˆÙ† Ø§Ù„ØªÙ‡Ù…ÙˆØ§ Ø§Ù„Ø³Ø¹Ø±Ø§ØªØŒ Ø®ÙÙ‘Ø¶ Ø§Ù„Ø¯Ù‡ÙˆÙ† Ø£ÙˆÙ„Ø§Ù‹
      const deficit = -carb_kcal;
      const reducibleFatKcal = Math.min(deficit, kcal_from_fat - fat_min*9);
      carb_kcal = 0;
      // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† Ù„Ùˆ Ù„Ø²Ù… â€” Ù„ÙƒÙ† Ù†ÙƒØªÙÙŠ Ø¨Ù‡Ø°Ø§.
    }
    const carbs_g = Math.max(0, Math.round(carb_kcal / 4));

    // BMI
    const height_m = cm/100;
    const bmi = kg / (height_m*height_m);
    let bmiClass = "Ø·Ø¨ÙŠØ¹ÙŠ";
    if(bmi < 18.5) bmiClass = "Ù†Ø­Ø§ÙØ©";
    else if(bmi < 25) bmiClass = "Ø·Ø¨ÙŠØ¹ÙŠ";
    else if(bmi < 30) bmiClass = "Ø²ÙŠØ§Ø¯Ø© ÙˆØ²Ù†";
    else bmiClass = "Ø³Ù…Ù†Ø©";

    // expected change
    const weeklyChangeKg = goal==="maintain" ? 0 : rate * (goal==="lose"? -1 : 1);

    // UI out
    resultsCard.style.display = "block";
    labels.caloriesOut.textContent = targetCalories.toLocaleString("ar-EG");
    labels.proteinOut.textContent  = protein_g.toLocaleString("ar-EG")+" Øº";
    labels.fatOut.textContent      = fat_g.toLocaleString("ar-EG")+" Øº";
    labels.carbOut.textContent     = carbs_g.toLocaleString("ar-EG")+" Øº";

    labels.calBar.style.width = Math.min(100, targetCalories/40) + "%"; // ØªÙ…Ø«ÙŠÙ„ Ø¨ØµØ±ÙŠ Ù†Ø³Ø¨ÙŠ
    labels.proBar.style.width = Math.min(100, protein_g/2.5) + "%";
    labels.fatBar.style.width = Math.min(100, fat_g/1.8) + "%";
    labels.carbBar.style.width = Math.min(100, carbs_g/3) + "%";

    labels.goalBadge.textContent = goal==="lose" ? "ØªÙ†Ø­ÙŠÙ" : goal==="gain" ? "Ø²ÙŠØ§Ø¯Ø©" : "Ø«Ø¨Ø§Øª";
    const delta = Math.round(deltaPerDay);
    const sign = delta>0 ? "+" : "";
    labels.deltaNote.innerHTML =
      goal==="maintain"
       ? `Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø«Ø¨Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù‘Ø±Ø© (TDEE): <b>${Math.round(tdee).toLocaleString("ar-EG")} Cal</b>.`
       : `ÙØ§Ø±Ù‚ ÙŠÙˆÙ…ÙŠ Ù…Ù‚Ø¯Ù‘Ø±: <b>${sign}${delta.toLocaleString("ar-EG")} Cal</b> ÙŠØ¹Ø§Ø¯Ù„ Ø­ÙˆØ§Ù„ÙŠ <b>${weeklyChangeKg.toFixed(2)} ÙƒØº/Ø£Ø³Ø¨ÙˆØ¹</b>.`;

    labels.bmiNote.innerHTML = `BMI: <b>${bmi.toFixed(1)}</b> (${bmiClass}). Ø§Ù„Ø·ÙˆÙ„: ${cm.toFixed(0)} Ø³Ù…ØŒ Ø§Ù„ÙˆØ²Ù†: ${kg.toFixed(1)} ÙƒØº.`;

    // save to localStorage
    saveState();
  }

  // form submit
  $("#calcForm").addEventListener("submit",(e)=>{ e.preventDefault(); compute(); });

  // reset
  resetBtn.addEventListener("click", ()=>{
    localStorage.removeItem("calPlanner:v1");
    window.location.reload();
  });

  // persist
  function saveState(){
    const state = {
      gender: segValue(genderSeg),
      unit: segValue(unitSeg),
      age: inputs.age.value,
      height: inputs.height.value,
      weight: inputs.weight.value,
      activity: inputs.activity.value,
      goal: inputs.goal.value,
      rate: inputs.rate.value,
      proteinPerKg: inputs.proteinPerKg.value
    };
    localStorage.setItem("calPlanner:v1", JSON.stringify(state));
  }
  function loadState(){
    const raw = localStorage.getItem("calPlanner:v1");
    if(!raw) return;
    try{
      const s = JSON.parse(raw);
      // restore segs
      [...genderSeg.querySelectorAll("button")].forEach(b=>b.classList.toggle("active", b.dataset.val===s.gender));
      [...unitSeg.querySelectorAll("button")].forEach(b=>b.classList.toggle("active", b.dataset.val===s.unit));
      updateUnitPlaceholders(s.unit || "metric");
      // inputs
      inputs.age.value = s.age ?? inputs.age.value;
      inputs.height.value = s.height ?? "";
      inputs.weight.value = s.weight ?? "";
      inputs.activity.value = s.activity ?? "1.55";
      inputs.goal.value = s.goal ?? "maintain";
      inputs.rate.value = s.rate ?? "0.50";
      inputs.proteinPerKg.value = s.proteinPerKg ?? "1.8";
      labels.rate.textContent = Number(inputs.rate.value).toFixed(2)+" ÙƒØº/Ø£Ø³Ø¨ÙˆØ¹";
      labels.protein.textContent = Number(inputs.proteinPerKg.value).toFixed(1)+" Øº/ÙƒØº";
    }catch{}
  }
  loadState();

  // auto-compute if all fields exist
  window.addEventListener("load", ()=>{
    const hasVals = inputs.height.value && inputs.weight.value;
    if(hasVals) compute();
  });
})();
</script>
</body>
</html>
