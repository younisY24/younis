
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>جسمك قوتك - رحلتك نحو اللياقة البدنية</title>
  
  <link rel="shortcut icon" href="/images/body.PNG" type="image/png">
  <link rel="manifest" href="manifest.json" crossorigin="use-credentials">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="icon" href="/images/body.png" type="image/PNG">
  <link rel="apple-touch-icon" href="/images/body.PNG">
  <meta name="theme-color" content="#0077b6">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      transition: background-color 0.3s, color 0.3s;
    }

    :root {
      --primary-dark: #003366;
      --primary-medium: #0066cc;
      --primary-light: #3399ff;
      --accent: #ff6b35;
      --light: #f0f8ff;
      --dark: #001a33;
      --text-light: #ffffff;
      --text-dark: #001a33;
      --store-color: #4CAF50;
    }

    body {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary-medium));
      color: var(--text-light);
      line-height: 1.7;
      min-height: 100vh;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    :root{
      /* Palette — soothing eye-friendly */
      --bg: #f5f9fc;             /* page background */
      --bg-2: #eef5fa;           /* subtle gradient stop */
      --card: #ffffff;           /* cards */
      --ink: #223042;            /* main text */
      --muted: #6b7b8c;          /* secondary text */
      --line: #d8e3ee;           /* borders */

      --primary: #2f9ecb;        /* buttons / accents */
      --primary-2: #47ccb5;      /* gradient partner */
      --primary-3: #79d8e6;      /* soft bar color */

      --ok: #11b981;             /* success */
      --warn: #ffb650;           /* warning */
      --danger: #ff6b6b;         /* danger */

      --chip-bg: #e8f5ff;
      --chip-ink: #105b7c;

      --radius-lg: 16px;
      --radius-md: 12px;
      --radius-sm: 10px;

      --shadow-1: 0 10px 25px rgba(26, 78, 119, .08);
      --shadow-2: 0 20px 38px rgba(26, 78, 119, .10);
    }

    /* Global reset-ish */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Inter, Arial, "Noto Kufi Arabic", "Tajawal", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(1200px 800px at 10% -10%, var(--bg-2) 0%, transparent 60%),
        radial-gradient(1200px 800px at 110% 20%, #e9f4ff 0%, transparent 60%),
        linear-gradient(180deg, var(--bg), #f8fbff);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* Layout */
    .nav{
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: saturate(1.1) blur(8px);
      background: color-mix(in oklab, #ffffff 85%, #dbf2ff);
      border-bottom: 1px solid var(--line);
      box-shadow: var(--shadow-1);
    }
    .nav-inner{
      max-width: 1200px; margin: 0 auto; padding: 12px 16px;
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight: 900; letter-spacing:.2px;
    }
    .brand i{
      display:inline-flex; width:36px; height:36px; align-items:center; justify-content:center;
      border-radius:12px; background: linear-gradient(135deg, var(--primary), var(--primary-2));
      color: white; font-style: normal; font-weight: 900;
      box-shadow: 0 8px 20px rgba(47,158,203,.25);
    }
    .actions{display:flex; gap:8px; align-items:center}
    .chip{
      background: var(--chip-bg); color: var(--chip-ink); padding:6px 10px; border-radius: 999px; font-weight: 800; font-size: 12px;
      border: 1px solid #cfe8ff;
    }

    .container{ max-width: 1100px; margin: 20px auto; padding: 0 16px; }

    .grid{ display: grid; grid-template-columns: repeat(12, 1fr); gap: 14px; }
    .card{
      grid-column: 1 / -1;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-1);
      padding: 18px;
    }
    .two-col{ grid-column: 1 / -1; }
    @media (min-width: 900px){ .two-col{ grid-column: span 6; } }

    h1, h2, h3 { margin: 0 0 10px; }
    h1{ font-size: 28px; }
    h2{ font-size: 22px; }
    p.muted{ color: var(--muted); margin: .25rem 0 1rem; }

    /* Form */
    .row{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .row3{ display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    @media (max-width: 720px){ .row, .row3{ grid-template-columns: 1fr; } }

    .field{ display:flex; flex-direction: column; }
    label{ font-size: 13px; color: var(--muted); margin-bottom: 6px; }

    input[type="number"], input[type="text"], select{
      background: #f7fbfe; color: var(--ink);
      border: 1px solid var(--line);
      border-radius: var(--radius-md);
      padding: 10px 12px; outline: none;
      transition: border-color .2s, box-shadow .2s;
    }
    input:focus, select:focus{
      border-color: color-mix(in oklab, var(--primary) 60%, #ffffff);
      box-shadow: 0 0 0 4px rgba(47,158,203,.12);
      background: white;
    }

    .seg{
      display:flex; gap:0; border:1px solid var(--line); border-radius: var(--radius-md); overflow:hidden; background:#f7fbfe;
    }
    .seg button{
      appearance:none; flex:1; border:0; background:transparent; padding:10px 8px; cursor:pointer; font-weight:800; color: var(--muted);
    }
    .seg button.active{
      color:#063d53; background: linear-gradient(90deg, var(--primary-3), #d3f2ea);
    }

    .btn{
      appearance:none; border:0; border-radius: var(--radius-md);
      background: linear-gradient(90deg, var(--primary), var(--primary-2));
      color: white; padding: 12px 16px; font-weight: 900; cursor: pointer;
      box-shadow: 0 12px 26px rgba(47,158,203,.25);
      transition: transform .06s ease, box-shadow .2s ease;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: var(--shadow-2); }
    .btn:active{ transform: translateY(1px); }
    .btn-outline{
      background: #f7fbfe; color: var(--ink); border: 1px solid var(--line); box-shadow:none;
    }

    .stack-8{ height: 8px; }
    .stack-12{ height: 12px; }

    /* Results */
    .results{ display:grid; grid-template-columns: repeat(12, 1fr); gap: 12px; }
    .kpi{
      grid-column: span 12;
      background: #f7fbfe; border: 1px solid var(--line); border-radius: var(--radius-md);
      padding: 14px;
    }
    @media (min-width: 820px){ .kpi{ grid-column: span 3; } }

    .kpi h3{ margin:0; font-size: 13px; color: var(--muted); }
    .kpi .val{ font-size: 24px; font-weight: 900; margin-top: 6px; letter-spacing:.2px; }
    .bar{ height: 10px; background: #e9f4ff; border-radius: 999px; overflow: hidden; margin-top: 8px; }
    .bar > i{ display:block; height:100%; width:0 }
    .cal{ background: linear-gradient(90deg, #56e3b0, #69b8e6); }
    .pro{ background: linear-gradient(90deg, #6be6ff, #79b8ff); }
    .fat{ background: linear-gradient(90deg, #ffd86b, #ff9e6b); }
    .carb{ background: linear-gradient(90deg, #8be0ff, #bda8ff); }

    .note{ background:#f7fbfe; border:1px solid var(--line); border-radius: var(--radius-md); padding: 12px; }
    .tag{ display:inline-block; font-size:12px; color:#063d53; background: #dff4ff; padding: 4px 10px; border-radius: 999px; font-weight: 900; border:1px solid #bfe7ff; }

    .footer-note{ color: var(--muted); font-size: 12px; margin-top: 12px; }

    /* Helper visuals */
    .grid-2{
      display:grid; grid-template-columns: 1fr 1fr; gap: 12px;
    }
    @media (max-width: 720px){ .grid-2{ grid-template-columns: 1fr; } }

    /* Toast */
    .toast{
      position: fixed; inset-inline: 0; bottom: 16px; margin-inline:auto;
      max-width: 520px; width: calc(100% - 32px);
      background: #063d53; color: #dff4ff; border-radius: 12px; padding: 12px 14px;
      box-shadow: var(--shadow-2); display:none; z-index: 1000;
    }
    .toast.show{ display:block; animation: toastIn .25s ease; }
    @keyframes toastIn{ from{ transform: translateY(10px); opacity:0 } to{ transform: translateY(0); opacity:1 } }

  </style>
</head>
<body>

  <!-- ============================  NAV  ============================ -->
  <header class="nav">
    <div class="nav-inner">
      <div class="brand">
        <i>🔥</i>
        <div>حاسبة السعرات والماكروز</div>
      </div>
      <div class="actions">
        <span class="chip">متجاوبة للجوال والكمبيوتر</span>
        <span class="chip">ألوان مريحة</span>
      </div>
    </div>
  </header>

  <!-- ============================  MAIN  ============================ -->
  <main class="container">
    <div class="grid">

      <!-- ======== INTRO / FORM CARD ======== -->
      <section class="card two-col" id="formCard" aria-labelledby="formTitle">
        <h1 id="formTitle">خطط سعراتك وماكروزك بسهولة</h1>
        <p class="muted">
          نعتمد <b>Mifflin–St Jeor</b> لحساب معدل الأيض الأساسي (BMR) ثم ضربه بمعامل النشاط لإخراج TDEE.
          اختر هدفك (تنحيف/ثبات/زيادة) وحدد سرعة التغيير ليتم احتساب السعرات اليومية وتوزيع الماكروز المناسب تلقائيًا.
        </p>

        <!-- ----------- FORM ----------- -->
        <form id="calcForm" novalidate>
          <!-- gender / unit -->
          <div class="row">
            <div class="field">
              <label for="genderSeg">الجنس</label>
              <div class="seg" id="genderSeg" role="tablist" aria-label="الجنس">
                <button type="button" data-val="male" class="active" role="tab" aria-selected="true">ذكر</button>
                <button type="button" data-val="female" role="tab" aria-selected="false">أنثى</button>
              </div>
            </div>
            <div class="field">
              <label for="unitSeg">الوحدات</label>
              <div class="seg" id="unitSeg" role="tablist" aria-label="الوحدات">
                <button type="button" data-val="metric" class="active" role="tab" aria-selected="true">متري (كغ/سم)</button>
                <button type="button" data-val="imperial" role="tab" aria-selected="false">إنجليزي (رطل/إنش)</button>
              </div>
            </div>
          </div>

          <!-- age / height / weight -->
          <div class="row3" aria-label="القياسات">
            <div class="field">
              <label for="age">العمر (سنة)</label>
              <input type="number" id="age" min="10" max="100" required placeholder="مثال: 28" inputmode="numeric" autocomplete="off" aria-describedby="ageHelp">
              <small id="ageHelp" class="muted">الحد 10–100 سنة</small>
            </div>
            <div class="field">
              <label for="height">الطول</label>
              <input type="number" id="height" step="0.1" required placeholder="سم" inputmode="decimal" autocomplete="off">
            </div>
            <div class="field">
              <label for="weight">الوزن</label>
              <input type="number" id="weight" step="0.1" required placeholder="كغ" inputmode="decimal" autocomplete="off">
            </div>
          </div>

          <!-- activity / goal -->
          <div class="row">
            <div class="field">
              <label for="activity">مستوى النشاط</label>
              <select id="activity" required>
                <option value="1.2">خامل (بدون تمارين)</option>
                <option value="1.375">خفيف (1–3 أيام/أسبوع)</option>
                <option value="1.55" selected>متوسط (3–5 أيام/أسبوع)</option>
                <option value="1.725">عالٍ (6–7 أيام/أسبوع)</option>
                <option value="1.9">شديد جدًا (عمل جسدي/تمارين مزدوجة)</option>
              </select>
            </div>
            <div class="field">
              <label for="goal">الهدف</label>
              <select id="goal" required>
                <option value="lose">تنحيف</option>
                <option value="maintain" selected>ثبات</option>
                <option value="gain">زيادة وزن/كتلة</option>
              </select>
            </div>
          </div>

          <!-- rate / protein per kg -->
          <div class="row">
            <div class="field">
              <label for="rate">سرعة التغيير (كغ/أسبوع)</label>
              <input type="range" id="rate" min="0.10" max="1.00" step="0.05" value="0.50" aria-valuemin="0.10" aria-valuemax="1.00" aria-valuenow="0.50">
              <div class="muted" id="rateLabel">0.50 كغ/أسبوع</div>
            </div>
            <div class="field">
              <label for="proteinPerKg">تركيبة البروتين (غ/كغ)</label>
              <input type="range" id="proteinPerKg" min="1.2" max="2.4" step="0.1" value="1.8" aria-valuemin="1.2" aria-valuemax="2.4" aria-valuenow="1.8">
              <div class="muted" id="proteinLabel">1.8 غ/كغ</div>
            </div>
          </div>

          <!-- actions -->
          <div class="stack-12"></div>
          <div class="grid-2">
            <button class="btn" id="calcBtn" type="submit">احسب السعرات والماكروز</button>
            <button class="btn btn-outline" id="resetBtn" type="button" aria-label="إعادة ضبط">إعادة ضبط</button>
          </div>
        </form>
      </section>

      <!-- ======== RESULTS CARD ======== -->
      <section class="card two-col" id="resultsCard" aria-live="polite" style="display:none">
        <h2 style="margin-top:0">نتائجك</h2>

        <!-- KPI bars -->
        <div class="results" role="group" aria-label="المؤشرات الرئيسية">
          <div class="kpi">
            <h3>السعرات اليومية (Cal)</h3>
            <div class="val" id="caloriesOut">—</div>
            <div class="bar" aria-hidden="true"><i class="cal" id="calBar"></i></div>
          </div>
          <div class="kpi">
            <h3>البروتين (غ)</h3>
            <div class="val" id="proteinOut">—</div>
            <div class="bar" aria-hidden="true"><i class="pro" id="proBar"></i></div>
          </div>
          <div class="kpi">
            <h3>الدهون (غ)</h3>
            <div class="val" id="fatOut">—</div>
            <div class="bar" aria-hidden="true"><i class="fat" id="fatBar"></i></div>
          </div>
          <div class="kpi">
            <h3>الكربوهيدرات (غ)</h3>
            <div class="val" id="carbOut">—</div>
            <div class="bar" aria-hidden="true"><i class="carb" id="carbBar"></i></div>
          </div>
        </div>

        <div class="stack-12"></div>

        <!-- notes -->
        <div class="grid-2">
          <div class="note">
            <div class="tag" id="goalBadge">ثبات</div>
            <div class="stack-8"></div>
            <p class="muted" id="deltaNote">—</p>
          </div>
          <div class="note">
            <strong>مؤشر كتلة الجسم (BMI)</strong>
            <div class="stack-8"></div>
            <p class="muted" id="bmiNote">—</p>
          </div>
        </div>

        <p class="footer-note">
          تنبيه غير طبي: هذه تقديرات عامة لأغراض لياقية فقط وقد لا تناسب جميع الحالات الصحية. استشر مختصًا إذا كان لديك أي حالة طبية.
        </p>
      </section>

    </div>
  </main>

  <!-- ============================  TOAST  ============================ -->
  <div class="toast" id="toast" role="status" aria-live="polite">تم حفظ الإعدادات تلقائيًا.</div>

  <!-- ============================  SCRIPT  ============================ -->
  <script>
  (function(){
    "use strict";

    // ---------- Shortcuts ----------
    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));

    // ---------- Elements ----------
    const genderSeg = $("#genderSeg");
    const unitSeg   = $("#unitSeg");
    const calcForm  = $("#calcForm");
    const resultsCard = $("#resultsCard");

    const inputs = {
      age: $("#age"),
      height: $("#height"),
      weight: $("#weight"),
      activity: $("#activity"),
      goal: $("#goal"),
      rate: $("#rate"),
      proteinPerKg: $("#proteinPerKg"),
    };

    const out = {
      rateLabel: $("#rateLabel"),
      proteinLabel: $("#proteinLabel"),
      goalBadge: $("#goalBadge"),
      deltaNote: $("#deltaNote"),
      bmiNote: $("#bmiNote"),
      caloriesOut: $("#caloriesOut"),
      proteinOut: $("#proteinOut"),
      fatOut: $("#fatOut"),
      carbOut: $("#carbOut"),
      calBar: $("#calBar"),
      proBar: $("#proBar"),
      fatBar: $("#fatBar"),
      carbBar: $("#carbBar"),
    };

    const resetBtn = $("#resetBtn");
    const toastEl  = $("#toast");

    // ---------- Segmented Controls ----------
    function segValue(seg){ const a = seg.querySelector("button.active"); return a ? a.dataset.val : null; }
    function setSeg(seg, value){
      $$(".active", seg).forEach(b=>b.classList.remove("active"));
      const btn = seg.querySelector(`button[data-val="${value}"]`) || seg.firstElementChild;
      btn.classList.add("active");
      // ARIA
      $$("button", seg).forEach(b=>b.setAttribute("aria-selected", String(b === btn)));
    }
    function bindSeg(seg, onChange){
      seg.addEventListener("click", e=>{
        if(e.target.tagName!=="BUTTON") return;
        setSeg(seg, e.target.dataset.val);
        onChange?.(e.target.dataset.val);
      });
      seg.addEventListener("keydown", e=>{
        const items = $$("button", seg);
        const idx = items.findIndex(b => b.classList.contains("active"));
        if(e.key === "ArrowLeft" || e.key === "ArrowUp"){
          e.preventDefault(); const ni = (idx - 1 + items.length) % items.length; setSeg(seg, items[ni].dataset.val); items[ni].focus();
        }
        if(e.key === "ArrowRight" || e.key === "ArrowDown"){
          e.preventDefault(); const ni = (idx + 1) % items.length; setSeg(seg, items[ni].dataset.val); items[ni].focus();
        }
      });
    }
    bindSeg(genderSeg);
    bindSeg(unitSeg, (val)=> updateUnitPlaceholders(val));

    // ---------- Units ----------
    function updateUnitPlaceholders(unit){
      if(unit==="imperial"){
        inputs.height.placeholder="إنش";
        inputs.weight.placeholder="رطل";
        inputs.height.min=40; inputs.height.max=100; // inches
        inputs.weight.min=60; inputs.weight.max=660; // lb
      }else{
        inputs.height.placeholder="سم";
        inputs.weight.placeholder="كغ";
        inputs.height.min=80; inputs.height.max=250;
        inputs.weight.min=30; inputs.weight.max=300;
      }
    }
    updateUnitPlaceholders(segValue(unitSeg)||"metric");

    // ---------- Live labels ----------
    inputs.rate.addEventListener("input", ()=> out.rateLabel.textContent = Number(inputs.rate.value).toFixed(2) + " كغ/أسبوع");
    inputs.proteinPerKg.addEventListener("input", ()=> out.proteinLabel.textContent = Number(inputs.proteinPerKg.value).toFixed(1) + " غ/كغ");

    // ---------- Helpers ----------
    const clamp = (v,min,max)=> Math.min(Math.max(v,min), max);
    const toNumber = (el)=> Number(String(el.value).replace(",","."));

    function cmKgFromInputs(){
      const unit = segValue(unitSeg);
      let cm = toNumber(inputs.height);
      let kg = toNumber(inputs.weight);
      if(unit==="imperial"){
        cm = cm * 2.54;          // in -> cm
        kg = kg * 0.45359237;    // lb -> kg
      }
      return { cm, kg };
    }

    // BMR — Mifflin–St Jeor
    function mifflin({gender, kg, cm, age}){
      return 10*kg + 6.25*cm - 5*age + (gender==="male" ? 5 : -161);
    }

    // ---------- Compute ----------
    function compute(){
      const gender = segValue(genderSeg) || "male";
      const age = clamp(toNumber(inputs.age), 10, 100);
      const { cm, kg } = cmKgFromInputs();
      const activity = Number(inputs.activity.value);
      const goal = inputs.goal.value; // lose / maintain / gain
      const rate = clamp(Number(inputs.rate.value), 0.10, 1.00);
      let proteinPerKg = clamp(Number(inputs.proteinPerKg.value), 1.2, 2.4);

      // validation
      if(!cm || !kg || !age || cm<80 || kg<30){
        showToast("تحقق من إدخال الطول/الوزن/العمر بشكل صحيح.");
        return;
      }

      // baseline
      const bmr = mifflin({ gender, kg, cm, age });
      const tdee = bmr * activity;

      // energy delta by goal
      const KCAL_PER_KG = 7700; // approximation
      let deltaPerDay = 0;
      if(goal === "lose") deltaPerDay = - (rate * KCAL_PER_KG) / 7;
      if(goal === "gain") deltaPerDay = + (rate * KCAL_PER_KG) / 7;

      // target calories with floors/ceilings
      let targetCalories = Math.round(tdee + deltaPerDay);
      const floor = (gender==="male") ? 1500 : 1200; // simple safety floor
      const ceil  = 5000;
      targetCalories = clamp(targetCalories, floor, ceil);

      // protein grams
      if(goal === "lose") proteinPerKg = Math.max(proteinPerKg, 2.0);
      const protein_g = Math.round(proteinPerKg * kg);

      // fat grams: >= 30% kcal or >= 0.6 g/kg
      const fat_g_by_pct = (targetCalories * 0.30) / 9;
      const fat_min = 0.6 * kg;
      const fat_g = Math.round(Math.max(fat_g_by_pct, fat_min));

      // carbs grams = remaining kcal
      const kcal_from_protein = protein_g * 4;
      const kcal_from_fat = fat_g * 9;
      let carb_kcal = targetCalories - (kcal_from_protein + kcal_from_fat);
      if(carb_kcal < 0){
        // reduce fat down to minimum to allow zero carbs at least
        const over = -carb_kcal;
        const possibleReduce = Math.max(0, (fat_g - fat_min) * 9);
        const reduce = Math.min(over, possibleReduce);
        carb_kcal = -(over - reduce); // if still negative, carbs=0
      }
      const carbs_g = Math.max(0, Math.round(carb_kcal / 4));

      // BMI
      const bmi = kg / Math.pow(cm/100, 2);
      let bmiClass = "طبيعي";
      if(bmi < 18.5) bmiClass = "نحافة";
      else if(bmi < 25) bmiClass = "طبيعي";
      else if(bmi < 30) bmiClass = "زيادة وزن";
      else bmiClass = "سمنة";

      // weekly change
      const weeklyChangeKg = goal==="maintain" ? 0 : rate * (goal==="lose" ? -1 : 1);

      // --- Output ---
      resultsCard.style.display = "block";
      out.caloriesOut.textContent = targetCalories.toLocaleString("ar-EG");
      out.proteinOut.textContent  = protein_g.toLocaleString("ar-EG") + " غ";
      out.fatOut.textContent      = fat_g.toLocaleString("ar-EG") + " غ";
      out.carbOut.textContent     = carbs_g.toLocaleString("ar-EG") + " غ";

      // bars (visual relative scaling with soft caps)
      out.calBar.style.width = Math.min(100, targetCalories/40) + "%";
      out.proBar.style.width = Math.min(100, protein_g/2.5) + "%";
      out.fatBar.style.width = Math.min(100, fat_g/1.8) + "%";
      out.carbBar.style.width = Math.min(100, carbs_g/3) + "%";

      out.goalBadge.textContent = goal === "lose" ? "تنحيف" : goal === "gain" ? "زيادة" : "ثبات";

      const delta = Math.round(deltaPerDay);
      const sign = delta > 0 ? "+" : "";
      out.deltaNote.innerHTML =
        goal === "maintain"
        ? `سعرات الثبات المقدّرة (TDEE): <b>${Math.round(tdee).toLocaleString("ar-EG")} Cal</b>.`
        : `فارق يومي مقدّر: <b>${sign}${delta.toLocaleString("ar-EG")} Cal</b> يعادل تقريبًا <b>${weeklyChangeKg.toFixed(2)} كغ/أسبوع</b>.`;

      out.bmiNote.innerHTML = `BMI: <b>${bmi.toFixed(1)}</b> (${bmiClass}). الطول: ${cm.toFixed(0)} سم، الوزن: ${kg.toFixed(1)} كغ.`;

      // save
      saveState();
    }

    // ---------- Form submit ----------
    calcForm.addEventListener("submit", function(ev){
      ev.preventDefault();
      compute();
    });

    // ---------- Reset ----------
    resetBtn.addEventListener("click", ()=>{
      localStorage.removeItem("calPlanner:v2");
      // clear inputs gracefully
      setSeg(genderSeg, "male");
      setSeg(unitSeg, "metric");
      inputs.age.value = "";
      inputs.height.value = "";
      inputs.weight.value = "";
      inputs.activity.value = "1.55";
      inputs.goal.value = "maintain";
      inputs.rate.value = "0.50";
      inputs.proteinPerKg.value = "1.8";
      out.rateLabel.textContent = "0.50 كغ/أسبوع";
      out.proteinLabel.textContent = "1.8 غ/كغ";
      resultsCard.style.display = "none";
      showToast("تمت إعادة الضبط.");
    });

    // ---------- Persistence ----------
    function saveState(){
      const state = {
        gender: segValue(genderSeg),
        unit: segValue(unitSeg),
        age: inputs.age.value,
        height: inputs.height.value,
        weight: inputs.weight.value,
        activity: inputs.activity.value,
        goal: inputs.goal.value,
        rate: inputs.rate.value,
        proteinPerKg: inputs.proteinPerKg.value
      };
      localStorage.setItem("calPlanner:v2", JSON.stringify(state));
      showToast(); // silent toast "saved"
    }

    function loadState(){
      const raw = localStorage.getItem("calPlanner:v2");
      if(!raw) return;
      try{
        const s = JSON.parse(raw);
        // segs
        if(s.gender) setSeg(genderSeg, s.gender);
        if(s.unit) { setSeg(unitSeg, s.unit); updateUnitPlaceholders(s.unit); }
        // inputs
        if(s.age != null) inputs.age.value = s.age;
        if(s.height != null) inputs.height.value = s.height;
        if(s.weight != null) inputs.weight.value = s.weight;
        if(s.activity) inputs.activity.value = s.activity;
        if(s.goal) inputs.goal.value = s.goal;
        if(s.rate) { inputs.rate.value = s.rate; out.rateLabel.textContent = Number(s.rate).toFixed(2)+" كغ/أسبوع"; }
        if(s.proteinPerKg) { inputs.proteinPerKg.value = s.proteinPerKg; out.proteinLabel.textContent = Number(s.proteinPerKg).toFixed(1)+" غ/كغ"; }
      }catch(e){ console.warn("state parse failed", e); }
    }
    loadState();

    // auto compute if previous values exist
    window.addEventListener("load", ()=>{
      const hasVals = inputs.height.value && inputs.weight.value && inputs.age.value;
      if(hasVals) compute();
    });

    // ---------- Toast ----------
    let toastTimer = null;
    function showToast(msg){
      const text = msg || "تم حفظ الإعدادات تلقائيًا.";
      toastEl.textContent = text;
      toastEl.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toastEl.classList.remove("show"), 1600);
    }

    // ---------- Accessibility helpers ----------
    // Allow Enter on sliders to compute
    ["rate","proteinPerKg"].forEach(id=>{
      inputs[id].addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ e.preventDefault(); compute(); } });
    });

  })();
  </script>
</body>
</html>
    /* Hero Section */
    .hero {
      text-align: center;
      margin-bottom: 50px;
      max-width: 800px;
      width: 100%;
      padding: 0 20px;
      animation: fadeIn 1s ease-out;
      position: relative;
    }

    .profile-container {
      width: 150px;
      height: 150px;
      margin: 0 auto 25px;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.3);
      padding: 6px;
      position: relative;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease;
    }

    .profile-container:hover {
      transform: scale(1.05);
    }

    .profile-image {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: url('https://i.ibb.co/rRXmsrBM/channels4-profile.jpg') center/cover;
    }

    .hero h1 {
      font-size: 2.2rem;
      margin-bottom: 15px;
      background: linear-gradient(to right, #ffffff, #caf0f8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1.3;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .hero p {
      font-size: 1.1rem;
      opacity: 0.9;
      margin-bottom: 10px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Store Button */
    .store-button {
      display: inline-block;
      margin-top: 25px;
      padding: 12px 30px;
      background: linear-gradient(135deg, var(--store-color), #2E7D32);
      color: white;
      border-radius: 30px;
      text-decoration: none;
      font-weight: bold;
      box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .store-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
    }

    /* Social Media Circles */
    .social-section {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    .section-title {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 40px;
      position: relative;
      animation: slideIn 0.8s ease-out;
    }

    .section-title::after {
      content: '';
      display: block;
      width: 80px;
      height: 4px;
      background: #ff6b35;
      border-radius: 2px;
      margin: 15px auto;
    }

    .social-circles {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 35px;
    }

    .social-circle {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      color: white;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      animation: popIn 0.6s ease-out;
      animation-fill-mode: backwards;
    }

    .social-circle:nth-child(1) {
      animation-delay: 0.2s;
    }
    
    .social-circle:nth-child(2) {
      animation-delay: 0.4s;
    }
    
    .social-circle:nth-child(3) {
      animation-delay: 0.6s;
    }

    .social-circle::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .social-circle:hover::before {
      background: rgba(0, 0, 0, 0.2);
      transform: scale(1.1);
    }

    .social-circle:hover {
      transform: translateY(-10px) scale(1.05);
      box-shadow: 0 15px 25px rgba(0, 0, 0, 0.3);
    }

    .social-icon {
      font-size: 2.8rem;
      margin-bottom: 12px;
      z-index: 2;
      transition: transform 0.3s ease;
    }

    .social-circle:hover .social-icon {
      transform: scale(1.2);
    }

    .social-name {
      font-size: 1.2rem;
      font-weight: 600;
      z-index: 2;
      text-align: center;
    }

    .youtube {
      background: linear-gradient(135deg, #ff0000, #cc0000);
    }

    .instagram {
      background: linear-gradient(135deg, #f09433, #dc2743, #bc1888);
    }

    .tiktok {
      background: linear-gradient(135deg, #00f2ea, #ff0050);
    }

    /* Advice Section */
    .advice-section {
      max-width: 800px;
      width: 100%;
      margin-top: 50px;
      padding: 0 20px;
      animation: fadeIn 1.2s ease-out;
    }

    .advice-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(5px);
      position: relative;
      text-align: center;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .advice-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #ff0000, #e4405f, #00f2ea);
      border-radius: 20px 20px 0 0;
    }

    .advice-text {
      font-size: 1.1rem;
      line-height: 1.8;
    }

    .advice-text strong {
      color: #ffcc00;
      font-weight: bold;
    }

    /* Floating Buttons */
    .floating-btns {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      z-index: 100;
    }

    .floating-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--primary-medium);
      color: white;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .floating-btn:hover {
      transform: scale(1.1);
      background: var(--primary-light);
    }

    .theme-toggle {
      background: linear-gradient(135deg, #ff6b35, #f7931e);
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes popIn {
      0% { opacity: 0; transform: scale(0.5); }
      70% { transform: scale(1.1); }
      100% { opacity: 1; transform: scale(1); }
    }

    /* Light Mode Styles */
    body.light-mode {
      background: linear-gradient(135deg, #e6f7ff, #b3e0ff);
      color: var(--text-dark);
    }

    body.light-mode .hero h1 {
      background: linear-gradient(to right, var(--primary-dark), var(--primary-medium));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    body.light-mode .social-circle {
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    }

    body.light-mode .advice-card {
      background: rgba(255, 255, 255, 0.7);
      color: var(--text-dark);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }

    body.light-mode .advice-text strong {
      color: #ff6b35;
    }

    body.light-mode .store-button {
      background: linear-gradient(135deg, var(--store-color), #388E3C);
    }

    /* Responsive Design */
    @media (max-width: 900px) {
      .social-circles {
        gap: 30px;
      }
      
      .social-circle {
        width: 140px;
        height: 140px;
      }
      
      .hero h1 {
        font-size: 1.9rem;
      }
    }

    @media (max-width: 768px) {
      .section-title {
        font-size: 1.6rem;
        margin-bottom: 30px;
      }
      
      .social-circles {
        gap: 25px;
      }
      
      .social-circle {
        width: 130px;
        height: 130px;
      }
      
      .social-icon {
        font-size: 2.3rem;
      }
      
      .social-name {
        font-size: 1.1rem;
      }
      
      .hero p {
        font-size: 1rem;
      }
      
      .floating-btns {
        bottom: 20px;
        right: 20px;
      }
      
      .floating-btn {
        width: 45px;
        height: 45px;
      }
    }

    @media (max-width: 600px) {
      .social-circles {
        flex-direction: column;
        align-items: center;
        gap: 35px;
      }
      
      .social-circle {
        width: 160px;
        height: 160px;
      }
      
      .hero h1 {
        font-size: 1.7rem;
      }
      
      .section-title {
        font-size: 1.5rem;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 15px;
      }
      
      .hero h1 {
        font-size: 1.6rem;
      }
      
      .profile-container {
        width: 130px;
        height: 130px;
      }
      
      .advice-card {
        padding: 25px 20px;
      }
      
      .advice-text {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <!-- Floating Buttons -->
  <div class="floating-btns">
    <div class="floating-btn" id="scrollTopBtn">
      <i class="fas fa-arrow-up"></i>
    </div>
    <div class="floating-btn" id="scrollBottomBtn">
      <i class="fas fa-arrow-down"></i>
    </div>
    <div class="floating-btn theme-toggle" id="themeToggle">
      <i class="fas fa-moon"></i>
    </div>
  </div>

  <!-- Hero Section -->
  <section class="hero">
    <div class="profile-container">
      <div class="profile-image"></div>
    </div>
    
    <h1>جسمك قوتك</h1>
    <p>رحلتك نحو اللياقة البدنية تبدأ من هنا</p>
    <p>تمارين منزلية بسيطة، نصائح غذائية، وبرامج تدريبية متكاملة</p>
    
    <a href="pt.html" class="store-button">
      <i class="fas fa-shopping-bag"></i> تصفح متجرنا
    </a>
  </section>

  <!-- Social Media Circles -->
  <section class="social-section">
    <h2 class="section-title">تواصل معنا</h2>
    
    <div class="social-circles">
      <a href="https://www.youtube.com/@body_ispower" target="_blank" class="social-circle youtube">
        <div class="social-icon">
          <i class="fab fa-youtube"></i>
        </div>
        <div class="social-name">يوتيوب</div>
      </a>
      
      <a href="https://www.instagram.com/body_ispower" target="_blank" class="social-circle instagram">
        <div class="social-icon">
          <i class="fab fa-instagram"></i>
        </div>
        <div class="social-name">إنستغرام</div>
      </a>
      
      <a href="https://www.tiktok.com/@body_ispower" target="_blank" class="social-circle tiktok">
        <div class="social-icon">
          <i class="fab fa-tiktok"></i>
        </div>
        <div class="social-name">تيك توك</div>
      </a>
    </div>
  </section>

  <!-- Advice Section -->
  <section class="advice-section">
    <div class="advice-card">
      <div class="advice-text">
        <p><strong>ابدأ بخطوات صغيرة:</strong> لا تحاول تغيير حياتك بالكامل في يوم واحد. ابدأ بـ <strong>25 دقيقة</strong> تمارين يومياً، ثم زد تدريجياً. الاستمرارية أهم من الشدة. تذكر أن كل خطوة تقربك من هدفك، ولا تستسلم إذا فاتك يوم واحد. العبرة في العودة والاستمرار.</p>
      </div>
    </div>
  </section>

  <script>
    // Theme Toggle Functionality - Fixed
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    
    // Check for saved theme preference or respect OS preference
    const savedTheme = localStorage.getItem('theme');
    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    
    // Set initial theme
    function setInitialTheme() {
      if (savedTheme) {
        if (savedTheme === 'light') {
          body.classList.add('light-mode');
          themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        } else {
          body.classList.remove('light-mode');
          themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }
      } else {
        // No saved theme, use OS preference
        if (prefersDarkScheme.matches) {
          body.classList.remove('light-mode');
          themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
          localStorage.setItem('theme', 'dark');
        } else {
          body.classList.add('light-mode');
          themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
          localStorage.setItem('theme', 'light');
        }
      }
    }
    
    // Apply initial theme
    setInitialTheme();
    
    // Toggle theme function
    function toggleTheme() {
      if (body.classList.contains('light-mode')) {
        body.classList.remove('light-mode');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        localStorage.setItem('theme', 'dark');
      } else {
        body.classList.add('light-mode');
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        localStorage.setItem('theme', 'light');
      }
    }
    
    // Add event listener
    themeToggle.addEventListener('click', toggleTheme);
    
    // Scroll to top button
    const scrollTopBtn = document.getElementById('scrollTopBtn');
    
    window.addEventListener('scroll', () => {
      if (window.pageYOffset > 300) {
        scrollTopBtn.style.opacity = '1';
        scrollTopBtn.style.visibility = 'visible';
      } else {
        scrollTopBtn.style.opacity = '0';
        scrollTopBtn.style.visibility = 'hidden';
      }
    });
    
    scrollTopBtn.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
    
    // Scroll to bottom button
    const scrollBottomBtn = document.getElementById('scrollBottomBtn');
    
    scrollBottomBtn.addEventListener('click', () => {
      window.scrollTo({
        top: document.body.scrollHeight,
        behavior: 'smooth'
      });
    });
    
    // Add animation to social circles on page load
    document.addEventListener('DOMContentLoaded', function() {
      const circles = document.querySelectorAll('.social-circle');
      
      circles.forEach((circle, index) => {
        circle.style.animationDelay = `${index * 0.2}s`;
      });
      
      // Listen for OS theme changes
      prefersDarkScheme.addEventListener('change', e => {
        if (savedTheme) return; // Respect user choice if already set
        
        if (e.matches) {
          body.classList.remove('light-mode');
          themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
          localStorage.setItem('theme', 'dark');
        } else {
          body.classList.add('light-mode');
          themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
          localStorage.setItem('theme', 'light');
        }
      });
    });
  </script>
  <script src="app.js"></script>
</body>
</html>
